FuncNode maxSize = 2;                      	   // 额外判定大小
FuncNode interfaceGap = 0.05;                  // 组件间距
FuncNode targetAspectRatio = 1115.0 / 640.0;   // 目标屏幕宽高比
FuncNode highWidth = 0.1;                      // 高位宽度与低位宽度比
FuncNode defaultAppearTime = 7.4 / 5.0;        // note 默认出现时间
FuncNode minSFXDistance = 0.02;                // 最小音效时间
FuncNode judgelineMarginBottom = 0.25;         // 判定线距离底部距离
FuncNode judgelineHeight = 0.133;              // 判定线高度
FuncNode judglineMoveLength = 0.01;            // judgline 微调距离
FuncNode noteMoveLength = 0.02;                // note 微调距离
FuncNode splitLineLength = 0.02;               // 分裂线宽度
FuncNode arrowPercent = 1.6;                   // 箭头所占比例
FuncNode arrowSpeed = 20;                      // 箭头速率常数
FuncNode splitLineAnimationStart = 0.75;       // 分裂线起始动画长度, basic: 0.7595
FuncNode splitLineAnimationEnd = 0.20;         // 分裂线结束动画长度, basic: 0.7595
FuncNode effectLinearHeight = 0.4375;          // 特效高度
FuncNode effectCircularHeight = 0.3125;        // 特效 2 高度
FuncNode effectDurationTime = 0.5;             // 特效持续时间
FuncNode effectDistance = 0.03125;             // 特效微调距离
FuncNode hiddenLineHeight = 0.3125;            // 隐藏线高度
FuncNode judgePerfectPlusRatio = 332.0 / 76.0; // 判定文字 Perfect+ 比例
FuncNode judgePerfectRatio = 307.0 / 76.0;     // 判定文字 Perfect 比例
FuncNode judgeGreatRatio = 247.0 / 76.0;       // 判定文字 Great 比例
FuncNode judgeGoodRatio = 237.0 / 76.0;        // 判定文字 Good 比例
FuncNode judgeBadRatio = 163.0 / 76.0;         // 判定文字 Bad 比例
FuncNode judgeMissRatio = 177.0 / 76.0;        // 判定文字 Miss 比例
FuncNode judgeAutoRatio = 216.0 / 76.0;        // 判定文字 Auto 比例
FuncNode judgeFastRatio = 121.0 / 52.0;        // 判定文字 Fast 比例
FuncNode judgeSlowRatio = 143.0 / 52.0;        // 判定文字 Slow 比例
FuncNode judgeTextHeight = 0.15;               // 判定文字高度
FuncNode judgeText2Height = 0.08;              // 判定文字 2 高度
FuncNode judgeTextDistance = 0.0;              // 判定文字间距
FuncNode judgeTextDuration = 0.1;			   // 判定文字动画时长
FuncNode comboNormalRatio = 154.0 / 37.0;      // 普通 combo 文字比例
FuncNode comboNormal0Ratio = 89.0 / 124.0;     // 普通 combo 0 比例
FuncNode comboNormal1Ratio = 89.0 / 119.0;     // 普通 combo 1 比例
FuncNode comboNormal2Ratio = 94.0 / 121.0;     // 普通 combo 2 比例
FuncNode comboNormal3Ratio = 90.0 / 124.0;     // 普通 combo 3 比例
FuncNode comboNormal4Ratio = 91.0 / 119.0;     // 普通 combo 4 比例
FuncNode comboNormal5Ratio = 89.0 / 122.0;     // 普通 combo 5 比例
FuncNode comboNormal6Ratio = 91.0 / 124.0;     // 普通 combo 6 比例
FuncNode comboNormal7Ratio = 91.0 / 119.0;     // 普通 combo 7 比例
FuncNode comboNormal8Ratio = 90.0 / 124.0;     // 普通 combo 8 比例
FuncNode comboNormal9Ratio = 90.0 / 124.0;     // 普通 combo 9 比例
FuncNode comboNormalPercentRatio = 27.0 / 28.0;// 普通 combo % 比例
FuncNode comboNormalPointRatio = 1;            // 普通 combo . 比例
FuncNode comboFCRatio = 154.0 / 37.0;          // FC combo 文字比例
FuncNode comboFC0Ratio = 89.0 / 124.0;         // FC combo 0 比例
FuncNode comboFC1Ratio = 89.0 / 119.0;         // FC combo 1 比例
FuncNode comboFC2Ratio = 94.0 / 121.0;         // FC combo 2 比例
FuncNode comboFC3Ratio = 90.0 / 124.0;         // FC combo 3 比例
FuncNode comboFC4Ratio = 91.0 / 119.0;         // FC combo 4 比例
FuncNode comboFC5Ratio = 89.0 / 122.0;         // FC combo 5 比例
FuncNode comboFC6Ratio = 91.0 / 124.0;         // FC combo 6 比例
FuncNode comboFC7Ratio = 91.0 / 119.0;         // FC combo 7 比例
FuncNode comboFC8Ratio = 90.0 / 124.0;         // FC combo 8 比例
FuncNode comboFC9Ratio = 90.0 / 124.0;         // FC combo 9 比例
FuncNode comboFCPercentRatio = 27.0 / 28.0;    // FC combo % 比例
FuncNode comboFCPointRatio = 1;                // FC combo . 比例
FuncNode comboAPRatio = 168.0 / 48.0;          // AP combo 文字比例
FuncNode comboAP0Ratio = 118.0 / 148.0;        // AP combo 0 比例
FuncNode comboAP1Ratio = 118.0 / 148.0;        // AP combo 1 比例
FuncNode comboAP2Ratio = 118.0 / 148.0;        // AP combo 2 比例
FuncNode comboAP3Ratio = 118.0 / 148.0;        // AP combo 3 比例
FuncNode comboAP4Ratio = 118.0 / 148.0;        // AP combo 4 比例
FuncNode comboAP5Ratio = 118.0 / 148.0;        // AP combo 5 比例
FuncNode comboAP6Ratio = 118.0 / 148.0;        // AP combo 6 比例
FuncNode comboAP7Ratio = 118.0 / 148.0;        // AP combo 7 比例
FuncNode comboAP8Ratio = 118.0 / 148.0;        // AP combo 8 比例
FuncNode comboAP9Ratio = 118.0 / 148.0;        // AP combo 9 比例
FuncNode comboAPPercentRatio = 28.0 / 30.0;    // AP combo % 比例
FuncNode comboAPPointRatio = 1;                // AP combo . 比例
FuncNode comboTextHeight = 0.05;               // combo 文字高度
FuncNode comboAPTextHeight = 0.066;            // AP combo 文字高度
FuncNode comboTextDistance = 0.015;            // combo 文字间距
FuncNode comboAPTextDistance = 0.003;          // AP combo 文字间距
FuncNode comboNumberHeight = 0.2;              // combo 数字高度
FuncNode comboAPNumberHeight = 0.238;          // AP 数字高度
FuncNode comboNumberDistance = 0.0;            // combo 数字间距
FuncNode comboAPNumberDistance = -0.048;       // AP combo 数字间距
FuncNode comboNumberHeight2 = 0.1;             // combo 数字高度 2
FuncNode comboAPNumberHeight2 = 0.119;         // AP 数字高度 2
FuncNode comboNumberDistance2 = 0.0;           // combo 数字间距 2
FuncNode comboAPNumberDistance2 = -0.024;      // AP combo 数字间距 2
FuncNode comboNumberHeight3 = 0.05;            // combo 数字高度 3
FuncNode comboAPNumberHeight3 = 0.059;         // AP 数字高度 3
FuncNode comboNumberDistance3 = 0.0;           // combo 数字间距 3
FuncNode comboAPNumberDistance3 = -0.012;      // AP combo 数字间距 3
FuncNode comboPointHeight = 0.025;             // combo . 高度
FuncNode comboAPPointHeight = 0.029;           // AP . 高度
FuncNode comboPercentHeight = 0.05;            // combo % 高度
FuncNode comboAPPercentHeight = 0.059;         // AP % 高度
FuncNode comboAccuracyDistance = 0.045;        // combo 完成度距离
FuncNode comboAPAccuracyDistance = 0.025;      // AP 完成度距离
FuncNode stageWidth = 0.7;                     // 单个舞台宽度
FuncNode stageHeight = 2.0;                    // 单个舞台高度
FuncNode stageFullWidth = stageWidth + 0.3;    // 单个舞台占有宽度
FuncNode stageTimelineWidth = stageWidth + 0.2;// 时间线宽度
FuncNode stageTimeLength = 2.0;                // 单个舞台容纳时间
FuncNode adjustDistance = 0.002;               // 按键微调距离
FuncNode noteCountDistance = 10;               // 按键计数长度
FuncNode noteBorderPercent = 0.02;             // note 边框比例 (相对于 Stage 大小)
#if defined(play) || defined(watch) || defined(tutorial)
FuncNode noteHeight = 85.0 / 640.0;            // note 高度
FuncNode tickWidth = 168.0 / 640.0;            // tick 宽度
FuncNode tickHeight = 112.0 / 640.0;           // tick 高度
FuncNode arrowWidth = 80.0 / 640.0;            // 箭头宽度
FuncNode arrowHeight = 240.0 / 640.0;          // 箭头高度
FuncNode syncLineHeight = 5.0 / 640.0;         // 同步线高度
FuncNode lineHeight = 114514;                  // 时间线高度(没用)
#endif
#if defined(preview)
FuncNode noteHeight = 0.04;                    // 按键高度
FuncNode tickWidth = 0.03;                     // tick 宽度
FuncNode tickHeight = 0.045;				   // tick 高度
FuncNode arrowWidth = 0.03;				       // 箭头宽度
FuncNode arrowHeight = 0.06;				   // 箭头高度
FuncNode syncLineHeight = 0.003; 			   // 同步线高度
FuncNode lineHeight = 0.008;                   // 时间线高度
#endif

#if defined(play) || defined(watch)
FuncNode mirror = Options.Mirror;
FuncNode speed = Options.NoteSpeed;
FuncNode hidden = Options.Hidden;
FuncNode autoSFX = Options.AutoSFX;
FuncNode splitRandom = Options.SplitRandom;
FuncNode splitLine = Options.SplitLine;
FuncNode syncLine = Options.SyncLine && splitRandom == 0;
FuncNode lockAspectRatio = Options.LockAspectRatio;
FuncNode extraWidth = Options.ExtraWidth;
FuncNode levelSpeed = Options.Speed;
FuncNode opacity = Options.StageOpacity;
FuncNode judgeType = Options.JudgeType;
FuncNode showAccuracy = Options.Accuracy;
FuncNode sonolusCombo = Options.SonolusCombo;
FuncNode sonolusJudgment = Options.SonolusJudgment;
FuncNode lightweight = Options.Lightweight;
#endif
#if defined(preview) || defined(tutorial)
FuncNode mirror = 0, speed = 5, hidden = 0, splitRandom = 0, splitLine = 1, syncLine = 1, lockAspectRatio = 1, extraWidth = 1;
FuncNode levelSpeed = 1, opacity = 0.8, judgeType = 2, showAccuracy = 0, sonolusCombo = 0, sonolusJudgment = 0, lightweight = 0;
#endif

FuncNode hasJudgment = HasSkinSprite(Sprites.JudgePerfectPlus) && !sonolusJudgment;
FuncNode hasCombo = HasSkinSprite(Sprites.ComboNormalText) && !sonolusCombo;

class screen {
    public:

    FuncNode aspectRatio = RuntimeEnvironment.screenAspectRatio;
    FuncNode l = -1 * aspectRatio;
    FuncNode b = -1;
    FuncNode r = aspectRatio;
    FuncNode t = 1;
    FuncNode w = aspectRatio * 2;
    FuncNode h = 2;
}screen;

#if defined(play) || defined(watch) || defined(tutorial)
class stage {
	public:

	FuncNode w = If(
        lockAspectRatio == 0 || screen.aspectRatio < targetAspectRatio,
        screen.w * extraWidth,
        screen.h * targetAspectRatio
    );
    FuncNode h = If(
        lockAspectRatio == 0 || screen.aspectRatio > targetAspectRatio,
        screen.h,
        screen.w / targetAspectRatio
    );
    FuncNode l = -1 * w / 2;
    FuncNode r = w / 2;
    FuncNode t = h / 2;
    FuncNode b = -1 * h / 2;
}stage;
#endif
#if defined(preview)
class stage {
	public:

	FuncNode w = 1, h = 1, l = 1, r = 1, t = 1, b = 1;
}stage;
#endif

class judgline {
    public:

    // 需要微调
    FuncNode lbX = Lerp(stage.l, stage.l * highWidth, judgelineMarginBottom - judgelineHeight / stage.h / 2) - judglineMoveLength;
    FuncNode lbY = stage.b + stage.h * judgelineMarginBottom - judgelineHeight / 2;
    FuncNode ltX = Lerp(stage.l, stage.l * highWidth, judgelineMarginBottom + judgelineHeight / stage.h / 2) - judglineMoveLength;
    FuncNode ltY = lbY + judgelineHeight;
    FuncNode rbX = Lerp(stage.r, stage.r * highWidth, judgelineMarginBottom - judgelineHeight / stage.h / 2) + judglineMoveLength;
    FuncNode rbY = lbY;
    FuncNode rtX = Lerp(stage.r, stage.r * highWidth, judgelineMarginBottom + judgelineHeight / stage.h / 2) + judglineMoveLength;
    FuncNode rtY = ltY;
}judgline;

FuncNode appearTime = 7.4 / speed;
FuncNode noteSpeed = stage.h / appearTime;

FuncNode t = If(
	lockAspectRatio && screen.aspectRatio < targetAspectRatio,
	screen.w / targetAspectRatio * 0.5,
	screen.t
);
FuncNode b = t - stage.h;

class judgment {
	public:

    FuncNode perfectPlus = 0.025;
    FuncNode perfect = 0.04;
    FuncNode great = 0.07;
    FuncNode good = 0.1;
    FuncNode bad = 0.125;
}judgment;

class judgeText {
    public:

    FuncNode perfectPlus = 0.025;
    FuncNode perfect = 0.04;
    FuncNode great = 0.07;
    FuncNode good = 0.1;
    FuncNode bad = 0.125;
}judgeText;

class score {
	public:

	FuncNode perfect = 1;
	FuncNode great = 0.8;
	FuncNode good = 0.5;
}score;

#if defined(play) || defined(watch)
var currentJudge;
var currentJudgeDeltaTime;
var currentJudgeStartTime;
Array<var, 16> splitLineMemory;
var comboNumber;
var comboStatus;
var lastNoteId;
var lastUpdatedId;
var firstComboTime;
var totalAccuracy;
var currentAccuracy;
Array<var, 21> order; // [0, 1), [1, 3), [3, 6), [6, 10), [10, 15), [15, 21)
var entityCount;
FuncNode duration, noteCount, noteId;
#endif
#if defined(preview)
var duration;                   // 谱面时长
var noteCount;                  // note 数量
auto unused_usdcnac_unused = [](){ return defaultAllocatorId = TemporaryMemoryId; }();
Array<var, 16> splitLineMemory;
auto unused_usdcna2c_unused = [](){ return defaultAllocatorId = PreviewDataId; }();
FuncNode currentJudge, currentJudgeStartTime, currentJudgeDeltaTime, comboNumber, comboStatus;
FuncNode lastNoteId, lastUpdatedId, firstComboTime, totalAccuracy, currentAccuracy;
#endif
#if defined(tutorial)
Array<var, 16> splitLineMemory;
FuncNode currentJudge, currentJudgeStartTime, currentJudgeDeltaTime, comboNumber, comboStatus;
FuncNode lastNoteId, lastUpdatedId, firstComboTime, totalAccuracy, currentAccuracy;
FuncNode duration, noteCount, noteId;
var spawnedEffect, spawnedLoopEffect, spawnedParticleEffect;
#endif

class ClipsArray {
    public:

    FuncNode perfect;
    FuncNode great;
    FuncNode good;
    FuncNode bad;
};

class EffectsArray {
	public:

    FuncNode linear;
    FuncNode circular;
};